# 数据库快速参考卡片

> 一日三餐项目 - 数据库管理常用命令

## 🔍 查看数据

```bash
# 查看数据库统计
cd backend && node scripts/cleanup-database.js stats

# 查看所有用户
mongo eatracker --eval "db.users.find().pretty()"

# 查看所有食材
mongo eatracker --eval "db.ingredients.find().pretty()"

# 查看用户数量
mongo eatracker --eval "db.users.count()"

# 查看食材数量
mongo eatracker --eval "db.ingredients.count()"

# 查看特定用户的食材
mongo eatracker --eval "db.ingredients.find({userId: ObjectId('用户ID')}).pretty()"
```

## 🗑️ 清理数据

```bash
# 删除所有用户和食材（推荐）
cd backend && node scripts/cleanup-database.js users

# 删除指定用户和其食材
cd backend && node scripts/cleanup-database.js user testuser

# 清空整个数据库
cd backend && node scripts/cleanup-database.js all

# 删除特定用户（手动）
mongo eatracker --eval "db.users.deleteOne({username: '用户名'})"

# 删除特定食材（手动）
mongo eatracker --eval "db.ingredients.deleteOne({_id: ObjectId('食材ID')})"
```

## 🧪 API测试

```bash
# 快速API测试
cd backend && npm install axios && node scripts/test-ingredient-api.js

# 功能演示
cd backend && node scripts/demo-ingredient-features.js

# 手动测试用户认证
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username": "testuser", "password": "test123", "name": "测试用户"}'

# 手动测试食材添加
export TOKEN="your_jwt_token_here"
curl -X POST http://localhost:5000/api/ingredients \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name": "苹果", "category": "水果", "quantity": 5, "unit": "个", "nutrition": {"calories": 52, "protein": 0.3, "carbs": 14, "fat": 0.2, "fiber": 2.4}, "expiryDate": "2024-12-31T00:00:00.000Z"}'
```

## 🚀 启动服务

```bash
# 启动后端服务
cd backend && npm run dev

# 启动前端服务（新终端）
cd frontend && npm start

# 检查服务状态
curl http://localhost:5000/  # 后端
curl http://localhost:3000/ # 前端
```

## ⚠️ 重要提醒

- **密码无法查看**: bcrypt加密不可逆
- **删除不可恢复**: 操作前请确认
- **用户信息一体**: 删除用户会清除所有个人信息（姓名、体重、身高等）
- **食材关联**: 删除用户会自动删除其所有食材
- **数据隔离**: 每个用户只能访问自己的食材

## 📋 数据库概念

- **数据库**: `eatracker`
- **用户集合**: `users`  
- **食材集合**: `ingredients`
- **错误操作**: `use users` ❌（这是切换到users数据库，不是访问users集合）
- **正确操作**: `use eatracker` → `db.users.find()` ✅

## 🔧 故障排除

```bash
# 检查MongoDB服务
brew services start mongodb-community

# 检查端口占用
lsof -i :5000  # 后端端口
lsof -i :3000  # 前端端口

# 查看服务日志
cd backend && npm run dev  # 查看后端日志
cd frontend && npm start   # 查看前端日志
```

---

*详细说明请参考: [数据库管理指南.md](./数据库管理指南.md)* 